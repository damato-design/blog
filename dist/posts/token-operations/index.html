<!DOCTYPE html><head><meta charset="UTF-8"><title>Token operations</title><meta name="viewport" content="width=device-width"><meta name="description" content="Design Systems Hot Takes"><meta name="generator" content="Astro v3.5.5"><meta property="og:title" content="Token operations"><meta property="og:description" content="Design Systems Hot Takes"><meta property="og:url" content="https://blog.damato.design/posts/token-operations/"><meta property="og:image" content="https://blog.damato.design/og-images/token-operations.png"><meta property="og:image:type" content="image/png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta property="og:image:alt" content="Donnie D'Amato's blog"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@donniedamato"><meta name="twitter:creator" content="@donniedamato"><meta name="twitter:title" content="Token operations"><meta name="twitter:description" content="Design Systems Hot Takes"><meta name="twitter:image" content="https://blog.damato.design/og-images/token-operations.png"><meta name="twitter:image:alt" content="Donnie D'Amato's blog"><link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="manifest" href="/site.webmanifest"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@300;700&family=PT+Sans+Narrow:wght@700&display=swap" rel="stylesheet"><style>@font-face{font-family:Garamond Nova;src:url(/fonts/garamondnova-italic.woff2) format("woff2");weight:400}@font-face{font-family:Garamond Nova;src:url(/fonts/garamondnova-light.woff2) format("woff2");weight:300}*,*:before,*:after{box-sizing:border-box}:root{--content-width: 860px;--card-width: 260px;--box-surface-bg: #f9f9f4;--box-surface-fg: #111;--box-contrast-bg: #001;--box-contrast-fg: #fff;--box-raised-bg: #fff;--box-raised-fg: #000;--box-raised-shadow: drop-shadow(0 .1rem .5rem rgba(0, 0, 0, .1))}body{margin:0;font-family:Merriweather,Book Antiqua,Palatino,Palatino Linotype,Palatino LT STD,Georgia,serif;font-size:1rem;font-weight:300;line-height:1.5;background:var(--box-surface-bg);color:var(--box-surface-fg);margin-bottom:10vw}img{max-width:100%}a{color:inherit;text-decoration-color:var(--heat);font-weight:700}.max-width{max-width:min(var(--content-width) - 2rem,100vw - 2rem);margin-inline:auto}header[data-astro-cid-3ef6ksr2]{padding-block:2rem}.max-width[data-astro-cid-3ef6ksr2]{display:flex;justify-content:space-between;align-items:center;gap:1rem}a[data-astro-cid-3ef6ksr2]{color:inherit;display:flex;flex-direction:column;text-decoration:none;line-height:1;font-size:1.5em}h1[data-astro-cid-3ef6ksr2]{font-size:1rem;font-weight:400;line-height:1;font-family:Garamond Nova}
.spine[data-astro-cid-vevxbnpu]{display:grid;grid-template-columns:auto 1fr auto;border-radius:2px;overflow:hidden}.spine[data-astro-cid-vevxbnpu]:after{content:"";display:block;grid-column:1 / -1;height:100%;grid-row:1 / -1;position:relative;pointer-events:none;box-shadow:inset 0 1rem 2rem #c8c8c880,inset 0 -1rem 2rem #c8c8c880}.animal[data-astro-cid-vevxbnpu]{grid-row:1;grid-column:1;width:16vw;max-width:10rem;display:flex;align-items:center;background:black;padding:1rem}.animal[data-astro-cid-vevxbnpu] img[data-astro-cid-vevxbnpu]{background:white;transform:rotate(-90deg)}.title[data-astro-cid-vevxbnpu]{grid-row:1;grid-column:2;container-type:inline-size;display:flex;align-items:center;justify-content:center;color:#fff;flex:1;font-family:Garamond Nova}.title[data-astro-cid-vevxbnpu] h2[data-astro-cid-vevxbnpu]{font-weight:300;font-size:8cqi;text-wrap:balance;line-height:1.1;padding:.25em;margin:0}.title[data-astro-cid-vevxbnpu] span[data-astro-cid-vevxbnpu]{text-wrap:nowrap;padding:1em;margin-inline-start:auto}.publisher[data-astro-cid-vevxbnpu]{grid-row:1;grid-column:3;background:black;color:#fff;display:flex;align-items:center;padding:1rem;text-decoration:none;--heat: currentColor}article{font-size:1.2em}article :where(h2,h3,h4,h5,h6){font-family:PT Sans Narrow;text-transform:capitalize}article code{font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;filter:brightness(.8)}article :not(pre)>code{color:var(--heat)}
</style></head><body style="--heat: #EA8729;"> <header data-astro-cid-3ef6ksr2> <div class="max-width" data-astro-cid-3ef6ksr2> <a href="/" data-astro-cid-3ef6ksr2> <svg xmlns="http://www.w3.org/2000/svg" role="presentation" viewBox="0 0 784.03 144.72" fill="currentColor" width="6em">
	<path d="m119.8,44.52c-3.62-8.51-8.68-15.94-15.18-22.31-6.5-6.36-14.1-11.32-22.81-14.87-8.71-3.55-18.16-5.33-28.34-5.33H0v140.7h53.87c10.05,0,19.43-1.77,28.14-5.33,8.71-3.55,16.28-8.51,22.71-14.87,6.43-6.36,11.46-13.83,15.07-22.41,3.62-8.57,5.43-17.82,5.43-27.74s-1.81-19.33-5.43-27.84Zm-24.42,53.47c-4.09,7.44-9.78,13.23-17.08,17.39-7.31,4.15-15.78,6.23-25.43,6.23h-29.75V23.11h29.75c9.51,0,17.92,2.08,25.23,6.23,7.3,4.15,13.03,9.92,17.19,17.29,4.15,7.37,6.23,15.88,6.23,25.53s-2.04,18.39-6.13,25.83Z" />
	<path style="fill: var(--heat, currentColor);" d="m160.9,4.52c-3.01-3.02-6.53-4.52-10.55-4.52s-7.71,1.51-10.65,4.52c-2.95,3.02-4.42,6.67-4.42,10.95,0,4.02,1.31,7.34,3.92,9.95,1.87,1.87,3.86,3.06,5.98,3.59l-11.91,22.24,12.26,6.63,14.87-27.34c1.88-3.62,3.18-6.6,3.92-8.94.73-2.34,1.11-4.39,1.11-6.13,0-4.29-1.51-7.94-4.52-10.95Z" />
	<path class="cls-1" d="m239.37,142.71h24.93L206.81,2.01h-16.08l-57.89,140.7h24.52l10.82-27.13h60.47l10.72,27.13Zm-63.18-47.23l22.36-56.1,22.16,56.1h-44.52Z" />
	<polygon points="396.95 2.01 343.69 89.69 290.42 2.01 274.34 2.01 274.34 142.71 297.46 142.71 297.46 52.61 335.65 115.37 351.73 115.37 389.92 52.61 389.92 142.71 413.03 142.71 413.03 2.01 396.95 2.01" />
	<path d="m529.61,142.71h24.92L497.05,2.01h-16.08l-57.89,140.7h24.52l10.82-27.13h60.47l10.72,27.13Zm-63.18-47.23l22.36-56.09,22.16,56.09h-44.52Z" />
	<polygon points="642.9 2.01 528.13 2.01 528.13 23.11 573.96 23.11 573.96 142.71 597.07 142.71 597.07 23.11 642.9 23.11 642.9 2.01" />
	<path d="m712.67,144.72c-10.05,0-19.43-1.88-28.14-5.63-8.71-3.75-16.35-8.94-22.91-15.58-6.57-6.63-11.69-14.34-15.38-23.12-3.69-8.77-5.53-18.19-5.53-28.24s1.84-19.43,5.53-28.14c3.68-8.71,8.78-16.38,15.28-23.01,6.5-6.63,14.07-11.79,22.71-15.48,8.64-3.68,17.99-5.53,28.04-5.53s19.4,1.84,28.04,5.53c8.64,3.69,16.25,8.84,22.81,15.48,6.56,6.63,11.69,14.34,15.38,23.12,3.68,8.78,5.53,18.19,5.53,28.24s-1.84,19.47-5.53,28.24c-3.69,8.78-8.78,16.45-15.28,23.01-6.5,6.57-14.07,11.73-22.71,15.48-8.64,3.75-17.92,5.63-27.84,5.63Zm-.4-22.11c9.51,0,17.85-2.14,25.02-6.43,7.17-4.29,12.79-10.22,16.88-17.79,4.09-7.57,6.13-16.31,6.13-26.23,0-7.37-1.17-14.1-3.52-20.2-2.35-6.1-5.66-11.39-9.95-15.88-4.29-4.49-9.35-7.94-15.18-10.35s-12.29-3.62-19.4-3.62c-9.38,0-17.66,2.11-24.82,6.33-7.17,4.22-12.8,10.08-16.88,17.59-4.09,7.51-6.13,16.22-6.13,26.13,0,7.37,1.17,14.17,3.52,20.4,2.34,6.23,5.63,11.56,9.85,15.98,4.22,4.42,9.28,7.87,15.18,10.35,5.9,2.48,12.33,3.72,19.3,3.72Z" />
</svg>
 <h1 data-astro-cid-3ef6ksr2>Design Systems Hot Takes</h1> </a> <a href="/feed.xml" data-astro-cid-3ef6ksr2> <svg viewBox="0 0 512 512" style="enable-background:new 0 0 512 512" role="presentation" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" width="2rem" fill="currentColor"><path d="M119.9 336.1c-30.8 0-55.9 25.1-55.9 55.8 0 30.8 25.1 55.6 55.9 55.6 30.9 0 55.9-24.9 55.9-55.6 0-30.7-25-55.8-55.9-55.8z"></path><path d="M64 192v79.9c48 0 94.1 14.2 128 48.1 33.9 33.9 48 79.9 48 128h80c0-139.9-116-256-256-256z"></path><path d="M64 64v79.9c171 0 303.9 133 303.9 304.1H448C448 236.3 276 64 64 64z"></path></svg> </a> </div> </header> <div data-astro-cid-vevxbnpu> <div class="spine max-width" data-astro-cid-vevxbnpu> <div class="animal" data-astro-cid-vevxbnpu> <img src="/animals/cheetah.png" data-astro-cid-vevxbnpu> </div> <div class="title" style="background: #EA8729" data-astro-cid-vevxbnpu> <h2 data-astro-cid-vevxbnpu>Token operations</h2> <span data-astro-cid-vevxbnpu>6 min read</span> </div> <a class="publisher" href="/" data-astro-cid-vevxbnpu> <svg xmlns="http://www.w3.org/2000/svg" role="presentation" viewBox="0 0 784.03 144.72" fill="currentColor" width="6em">
	<path d="m119.8,44.52c-3.62-8.51-8.68-15.94-15.18-22.31-6.5-6.36-14.1-11.32-22.81-14.87-8.71-3.55-18.16-5.33-28.34-5.33H0v140.7h53.87c10.05,0,19.43-1.77,28.14-5.33,8.71-3.55,16.28-8.51,22.71-14.87,6.43-6.36,11.46-13.83,15.07-22.41,3.62-8.57,5.43-17.82,5.43-27.74s-1.81-19.33-5.43-27.84Zm-24.42,53.47c-4.09,7.44-9.78,13.23-17.08,17.39-7.31,4.15-15.78,6.23-25.43,6.23h-29.75V23.11h29.75c9.51,0,17.92,2.08,25.23,6.23,7.3,4.15,13.03,9.92,17.19,17.29,4.15,7.37,6.23,15.88,6.23,25.53s-2.04,18.39-6.13,25.83Z" />
	<path style="fill: var(--heat, currentColor);" d="m160.9,4.52c-3.01-3.02-6.53-4.52-10.55-4.52s-7.71,1.51-10.65,4.52c-2.95,3.02-4.42,6.67-4.42,10.95,0,4.02,1.31,7.34,3.92,9.95,1.87,1.87,3.86,3.06,5.98,3.59l-11.91,22.24,12.26,6.63,14.87-27.34c1.88-3.62,3.18-6.6,3.92-8.94.73-2.34,1.11-4.39,1.11-6.13,0-4.29-1.51-7.94-4.52-10.95Z" />
	<path class="cls-1" d="m239.37,142.71h24.93L206.81,2.01h-16.08l-57.89,140.7h24.52l10.82-27.13h60.47l10.72,27.13Zm-63.18-47.23l22.36-56.1,22.16,56.1h-44.52Z" />
	<polygon points="396.95 2.01 343.69 89.69 290.42 2.01 274.34 2.01 274.34 142.71 297.46 142.71 297.46 52.61 335.65 115.37 351.73 115.37 389.92 52.61 389.92 142.71 413.03 142.71 413.03 2.01 396.95 2.01" />
	<path d="m529.61,142.71h24.92L497.05,2.01h-16.08l-57.89,140.7h24.52l10.82-27.13h60.47l10.72,27.13Zm-63.18-47.23l22.36-56.09,22.16,56.09h-44.52Z" />
	<polygon points="642.9 2.01 528.13 2.01 528.13 23.11 573.96 23.11 573.96 142.71 597.07 142.71 597.07 23.11 642.9 23.11 642.9 2.01" />
	<path d="m712.67,144.72c-10.05,0-19.43-1.88-28.14-5.63-8.71-3.75-16.35-8.94-22.91-15.58-6.57-6.63-11.69-14.34-15.38-23.12-3.69-8.77-5.53-18.19-5.53-28.24s1.84-19.43,5.53-28.14c3.68-8.71,8.78-16.38,15.28-23.01,6.5-6.63,14.07-11.79,22.71-15.48,8.64-3.68,17.99-5.53,28.04-5.53s19.4,1.84,28.04,5.53c8.64,3.69,16.25,8.84,22.81,15.48,6.56,6.63,11.69,14.34,15.38,23.12,3.68,8.78,5.53,18.19,5.53,28.24s-1.84,19.47-5.53,28.24c-3.69,8.78-8.78,16.45-15.28,23.01-6.5,6.57-14.07,11.73-22.71,15.48-8.64,3.75-17.92,5.63-27.84,5.63Zm-.4-22.11c9.51,0,17.85-2.14,25.02-6.43,7.17-4.29,12.79-10.22,16.88-17.79,4.09-7.57,6.13-16.31,6.13-26.23,0-7.37-1.17-14.1-3.52-20.2-2.35-6.1-5.66-11.39-9.95-15.88-4.29-4.49-9.35-7.94-15.18-10.35s-12.29-3.62-19.4-3.62c-9.38,0-17.66,2.11-24.82,6.33-7.17,4.22-12.8,10.08-16.88,17.59-4.09,7.51-6.13,16.22-6.13,26.13,0,7.37,1.17,14.17,3.52,20.4,2.34,6.23,5.63,11.56,9.85,15.98,4.22,4.42,9.28,7.87,15.18,10.35,5.9,2.48,12.33,3.72,19.3,3.72Z" />
</svg>
 </a> </div> </div> <div class="max-width" style="--heat: #EA8729;"> <!-- <Navigation headings={ toc.get(1).children } /> --> <article style="--heat: #EA8729;"> <p>I have been revisiting the infrastructure which supports themes at my day job where the number of tokens has exploded into the hundreds; thousands if you count the possibilities of defining custom ones for special needs. This makes the token curation process unwieldly when theming because assigning values to over 500 semantic tokens is very tedious.</p>
<p>The trouble is that while a certain brand or theme might have a few base values which give it personality, the final collection of tokens to define a theme will require slight variations of these base values for a properly curated presentation.</p>
<p>What if we could instead allow for a few values to be set in a theme to inform the rest of the values in some specified way?</p>
<h2 id="operations">Operations</h2>
<p><a href="https://github.com/design-tokens/community-group/issues/88#issuecomment-1029905903">First suggested within the Design Tokens Community Group by Jerome Farnum</a> we could consider a special key on the specification that expects an order of operations to be performed (<a href="https://github.com/design-tokens/community-group/issues/88#issuecomment-1073374383">example from James Nash</a>):</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-color-background);color:var(--astro-code-color-text); overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:var(--astro-code-color-text)">{</span></span>
<span class="line"><span style="color:var(--astro-code-token-keyword)">  "some-token"</span><span style="color:var(--astro-code-token-punctuation)">:</span><span style="color:var(--astro-code-color-text)"> {</span></span>
<span class="line"><span style="color:var(--astro-code-token-keyword)">    "$value"</span><span style="color:var(--astro-code-token-punctuation)">:</span><span style="color:var(--astro-code-token-string-expression)"> "#ff0000"</span><span style="color:var(--astro-code-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--astro-code-token-keyword)">    "$type"</span><span style="color:var(--astro-code-token-punctuation)">:</span><span style="color:var(--astro-code-token-string-expression)"> "color"</span><span style="color:var(--astro-code-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--astro-code-token-keyword)">    "$operations"</span><span style="color:var(--astro-code-token-punctuation)">:</span><span style="color:var(--astro-code-color-text)"> [</span></span>
<span class="line"><span style="color:var(--astro-code-color-text)">       { </span><span style="color:var(--astro-code-token-keyword)">"hue"</span><span style="color:var(--astro-code-token-punctuation)">:</span><span style="color:var(--astro-code-token-constant)"> -20</span><span style="color:var(--astro-code-color-text)"> }</span><span style="color:var(--astro-code-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--astro-code-color-text)">       { </span><span style="color:var(--astro-code-token-keyword)">"alpha"</span><span style="color:var(--astro-code-token-punctuation)">:</span><span style="color:var(--astro-code-token-constant)"> 0.3</span><span style="color:var(--astro-code-color-text)"> } </span></span>
<span class="line"><span style="color:var(--astro-code-color-text)">    ]</span></span>
<span class="line"><span style="color:var(--astro-code-color-text)">  }</span></span>
<span class="line"><span style="color:var(--astro-code-color-text)">}</span></span></code></pre>
<p>This is a good start but I saw two major flaws with this approach:</p>
<h3 id="freeform-naming">Freeform naming</h3>
<p>The words <code>hue</code> and <code>alpha</code> are meant to reference some external function that must exist in the token processing in order to transform to a final value. The algorithms used to determine the final output might be different or not exist at all. Each vendor must implement their own <code>hue</code> and <code>alpha</code> functions in order for these to be useful. This would require the specification to outline <em>every</em> kind of possible transform a theme author might want to use.</p>
<h3 id="custom-functions">Custom functions</h3>
<p>Furthermore, theme curators could be interested in creating their own custom functions which would need to be executed in vendors’ processes. In this format, there’s no clear way to define this. We can’t even support multiple arguments in the current suggestion.</p>
<h2 id="step-by-step">Step-by-step</h2>
<p>The solution I have for this is to implement a low-level language that can be built upon to make more complex functions. Here’s an example of what a token file could look like with a new take on <code>$operations</code>:</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-color-background);color:var(--astro-code-color-text); overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:var(--astro-code-color-text)">{</span></span>
<span class="line"><span style="color:var(--astro-code-token-keyword)">  "primary-color-overlay"</span><span style="color:var(--astro-code-token-punctuation)">:</span><span style="color:var(--astro-code-color-text)"> {</span></span>
<span class="line"><span style="color:var(--astro-code-token-keyword)">    "$type"</span><span style="color:var(--astro-code-token-punctuation)">:</span><span style="color:var(--astro-code-token-string-expression)"> "color"</span><span style="color:var(--astro-code-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--astro-code-token-keyword)">    "$value"</span><span style="color:var(--astro-code-token-punctuation)">:</span><span style="color:var(--astro-code-token-string-expression)"> "#fffc00"</span><span style="color:var(--astro-code-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--astro-code-token-keyword)">    "$operations"</span><span style="color:var(--astro-code-token-punctuation)">:</span><span style="color:var(--astro-code-color-text)"> [</span></span>
<span class="line"><span style="color:var(--astro-code-token-constant)">      0.5</span><span style="color:var(--astro-code-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--astro-code-color-text)">      [</span><span style="color:var(--astro-code-token-string-expression)">"String.match"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> "$value"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> "#([0-9A-Fa-f]{2})"</span><span style="color:var(--astro-code-color-text)">]</span><span style="color:var(--astro-code-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--astro-code-color-text)">      [</span><span style="color:var(--astro-code-token-string-expression)">"String.match"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> "$value"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> "#(?:[0-9A-Fa-f]{2})([0-9A-Fa-f]{2})"</span><span style="color:var(--astro-code-color-text)">]</span><span style="color:var(--astro-code-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--astro-code-color-text)">      [</span><span style="color:var(--astro-code-token-string-expression)">"String.match"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> "$value"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> "#(?:[0-9A-Fa-f]{4})([0-9A-Fa-f]{2})"</span><span style="color:var(--astro-code-color-text)">]</span><span style="color:var(--astro-code-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--astro-code-color-text)">      [</span><span style="color:var(--astro-code-token-string-expression)">"Math.parseInt"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> "$1"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-constant)"> 16</span><span style="color:var(--astro-code-color-text)">]</span><span style="color:var(--astro-code-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--astro-code-color-text)">      [</span><span style="color:var(--astro-code-token-string-expression)">"Math.parseInt"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> "$2"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-constant)"> 16</span><span style="color:var(--astro-code-color-text)">]</span><span style="color:var(--astro-code-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--astro-code-color-text)">      [</span><span style="color:var(--astro-code-token-string-expression)">"Math.parseInt"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> "$3"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-constant)"> 16</span><span style="color:var(--astro-code-color-text)">]</span><span style="color:var(--astro-code-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--astro-code-color-text)">      [</span><span style="color:var(--astro-code-token-string-expression)">"String.concat"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> ","</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> "$4"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> "$5"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> "$6"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> "$0"</span><span style="color:var(--astro-code-color-text)">]</span><span style="color:var(--astro-code-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--astro-code-color-text)">      [</span><span style="color:var(--astro-code-token-string-expression)">"String.concat"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> ""</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> "rgba("</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> "$7"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> ")"</span><span style="color:var(--astro-code-color-text)">]</span></span>
<span class="line"><span style="color:var(--astro-code-color-text)">    ]</span></span>
<span class="line"><span style="color:var(--astro-code-color-text)">  }</span></span>
<span class="line"><span style="color:var(--astro-code-color-text)">}</span></span></code></pre>
<p><a href="https://replit.com/@fauxserious/TokenOperations">See minimal prototype in action.</a></p>
<p>The <code>$operations</code> key is still an array which is necessary to ensure we can have a sequential step. The first concept is that each item (except for the first in this example) is an <strong>operation</strong>. It has the following signature:</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-color-background);color:var(--astro-code-color-text); overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:var(--astro-code-color-text)">[</span><span style="color:var(--astro-code-token-string-expression)">"OperationReference"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> "argument1"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> "argument2"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> "argument3"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-color-text)">...]</span></span></code></pre>
<p>The first item in each operation array references some well-known function that can be implemented across token processing tools and vendors. For this to work, I believe we’ll need at least <code>String</code> and <code>Math</code> with a few additional methods to support standard operations (eg., <code>Math.add</code>). This is something that can be included in the tokens specification if agreeable.</p>
<p>The result of each operation is stored in a special variable reference related to its index in the operations array. In the example above, the first operation (defined at index <code>1</code>) result is stored at <code>"$1"</code>. This result is used as an argument in the fifth operation (the first to use <code>Math.parseInt</code> above).  Primitive values in the operations array are simply stored as results to the index. Here’s the example again, with comments marking how results are stored:</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-color-background);color:var(--astro-code-color-text); overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:var(--astro-code-color-text)">{</span></span>
<span class="line"><span style="color:var(--astro-code-token-keyword)">  "primary-color-overlay"</span><span style="color:var(--astro-code-token-punctuation)">:</span><span style="color:var(--astro-code-color-text)"> {</span></span>
<span class="line"><span style="color:var(--astro-code-token-keyword)">    "$type"</span><span style="color:var(--astro-code-token-punctuation)">:</span><span style="color:var(--astro-code-token-string-expression)"> "color"</span><span style="color:var(--astro-code-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--astro-code-token-keyword)">    "$value"</span><span style="color:var(--astro-code-token-punctuation)">:</span><span style="color:var(--astro-code-token-string-expression)"> "#fffc00"</span><span style="color:var(--astro-code-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--astro-code-token-keyword)">    "$operations"</span><span style="color:var(--astro-code-token-punctuation)">:</span><span style="color:var(--astro-code-color-text)"> [</span></span>
<span class="line"><span style="color:var(--astro-code-token-constant)">      0.5</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-comment)"> // 0.5 stored at $0</span></span>
<span class="line"><span style="color:var(--astro-code-color-text)">      [</span><span style="color:var(--astro-code-token-string-expression)">"String.match"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> "$value"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> "#([0-9A-Fa-f]{2})"</span><span style="color:var(--astro-code-color-text)">]</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-comment)"> // 'ff' stored at $1</span></span>
<span class="line"><span style="color:var(--astro-code-color-text)">      [</span><span style="color:var(--astro-code-token-string-expression)">"String.match"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> "$value"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> "#(?:[0-9A-Fa-f]{2})([0-9A-Fa-f]{2})"</span><span style="color:var(--astro-code-color-text)">]</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-comment)"> // 'fc' stored at $2</span></span>
<span class="line"><span style="color:var(--astro-code-color-text)">      [</span><span style="color:var(--astro-code-token-string-expression)">"String.match"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> "$value"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> "#(?:[0-9A-Fa-f]{4})([0-9A-Fa-f]{2})"</span><span style="color:var(--astro-code-color-text)">]</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-comment)"> // '00' stored at $3</span></span>
<span class="line"><span style="color:var(--astro-code-color-text)">      [</span><span style="color:var(--astro-code-token-string-expression)">"Math.parseInt"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> "$1"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-constant)"> 16</span><span style="color:var(--astro-code-color-text)">]</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-comment)"> // 255 stored at $4</span></span>
<span class="line"><span style="color:var(--astro-code-color-text)">      [</span><span style="color:var(--astro-code-token-string-expression)">"Math.parseInt"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> "$2"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-constant)"> 16</span><span style="color:var(--astro-code-color-text)">]</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-comment)"> // 252 stored at $5</span></span>
<span class="line"><span style="color:var(--astro-code-color-text)">      [</span><span style="color:var(--astro-code-token-string-expression)">"Math.parseInt"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> "$3"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-constant)"> 16</span><span style="color:var(--astro-code-color-text)">]</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-comment)"> // 0 stored at $6</span></span>
<span class="line"><span style="color:var(--astro-code-color-text)">      [</span><span style="color:var(--astro-code-token-string-expression)">"String.concat"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> ","</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> "$4"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> "$5"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> "$6"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> "$0"</span><span style="color:var(--astro-code-color-text)">]</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-comment)"> // 255,252,0,0.5 stored at $7</span></span>
<span class="line"><span style="color:var(--astro-code-color-text)">      [</span><span style="color:var(--astro-code-token-string-expression)">"String.concat"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> ""</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> "rgba("</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> "$7"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> ")"</span><span style="color:var(--astro-code-color-text)">] </span><span style="color:var(--astro-code-token-comment)">// rgba(255,252,0,0.5) stored at $8</span></span>
<span class="line"><span style="color:var(--astro-code-color-text)">    ]</span></span>
<span class="line"><span style="color:var(--astro-code-color-text)">  }</span></span>
<span class="line"><span style="color:var(--astro-code-color-text)">}</span></span></code></pre>
<p>This would also include a special <code>$value</code> which refers to the original token value.</p>
<p>One of the larger benefits to this approach is that the low-level set of operations don’t receive a name, which avoids contention about naming of operations from within the specification (ie., should it be <code>opacity</code> or <code>alpha</code>). Names would only be needed when sharing sets of operations between token authors.</p>
<h2 id="reusing-common-operations">Reusing common operations</h2>
<p>Clearly, we would not want to write all of these operations in order to apply opacity to a given token each time. We’ll need a way to reference a set of operations. This could be supported by allowing an import syntax within the specification. <a href="https://github.com/design-tokens/community-group/issues/210#issuecomment-1501037423">I’ve suggested this idea before in the community group.</a> It could look like this for operations:</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-color-background);color:var(--astro-code-color-text); overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:var(--astro-code-color-text)">{</span></span>
<span class="line"><span style="color:var(--astro-code-token-keyword)">  "primary-color-overlay"</span><span style="color:var(--astro-code-token-punctuation)">:</span><span style="color:var(--astro-code-color-text)"> {</span></span>
<span class="line"><span style="color:var(--astro-code-token-keyword)">    "$type"</span><span style="color:var(--astro-code-token-punctuation)">:</span><span style="color:var(--astro-code-token-string-expression)"> "color"</span><span style="color:var(--astro-code-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--astro-code-token-keyword)">    "$value"</span><span style="color:var(--astro-code-token-punctuation)">:</span><span style="color:var(--astro-code-token-string-expression)"> "#fffc00"</span><span style="color:var(--astro-code-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--astro-code-token-keyword)">    "$operations"</span><span style="color:var(--astro-code-token-punctuation)">:</span><span style="color:var(--astro-code-color-text)"> [ </span></span>
<span class="line"><span style="color:var(--astro-code-token-comment)">      // All items after the import are used as arguments for the nested operation in order</span></span>
<span class="line"><span style="color:var(--astro-code-token-comment)">      // 0.5 stored at $0 for @token-operations/hex-opacity operations</span></span>
<span class="line"><span style="color:var(--astro-code-color-text)">      [</span><span style="color:var(--astro-code-token-string-expression)">"@token-operations/hex-opacity"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-constant)"> 0.5</span><span style="color:var(--astro-code-color-text)"> ]</span></span>
<span class="line"><span style="color:var(--astro-code-color-text)">    ]</span></span>
<span class="line"><span style="color:var(--astro-code-color-text)">  }</span></span>
<span class="line"><span style="color:var(--astro-code-color-text)">}</span></span></code></pre>
<p>In the above example <code>@token-operations/hex-opacity</code> is completely arbitrary and could be any package registry or url that has an array as the export. The expectation here is that folks might write projects that abstract low-level collections of operations into more user-friendly exports. This is similar to the purpose of the <a href="https://lit.dev/">Lit framework</a> for component authoring; to make web component development more accessible with a level of abstraction.</p>
<p>The special sauce would be within the operations parser. Since the first argument in an operation is meant to be a reference to a function (eg., <code>String.concat</code>), we could also check for a potential file to import here or have some other special syntax. The result would be to inject the operations array related to this reference in place as a nested operation with its own scoped step indicies. The trailing arguments of the import are then placed in the beginning of the imported operation set since each curated operation has an expected signature.</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-color-background);color:var(--astro-code-color-text); overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:var(--astro-code-color-text)">{</span></span>
<span class="line"><span style="color:var(--astro-code-token-keyword)">  "primary-color-overlay"</span><span style="color:var(--astro-code-token-punctuation)">:</span><span style="color:var(--astro-code-color-text)"> {</span></span>
<span class="line"><span style="color:var(--astro-code-token-keyword)">    "$type"</span><span style="color:var(--astro-code-token-punctuation)">:</span><span style="color:var(--astro-code-token-string-expression)"> "color"</span><span style="color:var(--astro-code-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--astro-code-token-keyword)">    "$value"</span><span style="color:var(--astro-code-token-punctuation)">:</span><span style="color:var(--astro-code-token-string-expression)"> "#fffc00"</span><span style="color:var(--astro-code-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--astro-code-token-keyword)">    "$operations"</span><span style="color:var(--astro-code-token-punctuation)">:</span><span style="color:var(--astro-code-color-text)"> [</span></span>
<span class="line"><span style="color:var(--astro-code-token-comment)">      // First level of operations</span></span>
<span class="line"><span style="color:var(--astro-code-color-text)">      [</span></span>
<span class="line"><span style="color:var(--astro-code-token-comment)">        // Second level of operations (nested), final output returns to parent operation result in place</span></span>
<span class="line"><span style="color:var(--astro-code-token-constant)">        0.5</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-comment)"> // First argument after import operation, placed at $0 in nested operation</span></span>
<span class="line"><span style="color:var(--astro-code-color-text)">        [</span><span style="color:var(--astro-code-token-string-expression)">"String.match"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> "$value"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> "#([0-9A-Fa-f]{2})"</span><span style="color:var(--astro-code-color-text)">]</span><span style="color:var(--astro-code-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--astro-code-color-text)">        [</span><span style="color:var(--astro-code-token-string-expression)">"String.match"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> "$value"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> "#(?:[0-9A-Fa-f]{2})([0-9A-Fa-f]{2})"</span><span style="color:var(--astro-code-color-text)">]</span><span style="color:var(--astro-code-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--astro-code-color-text)">        [</span><span style="color:var(--astro-code-token-string-expression)">"String.match"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> "$value"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> "#(?:[0-9A-Fa-f]{4})([0-9A-Fa-f]{2})"</span><span style="color:var(--astro-code-color-text)">]</span><span style="color:var(--astro-code-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--astro-code-color-text)">        [</span><span style="color:var(--astro-code-token-string-expression)">"Math.parseInt"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> "$1"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-constant)"> 16</span><span style="color:var(--astro-code-color-text)">]</span><span style="color:var(--astro-code-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--astro-code-color-text)">        [</span><span style="color:var(--astro-code-token-string-expression)">"Math.parseInt"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> "$2"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-constant)"> 16</span><span style="color:var(--astro-code-color-text)">]</span><span style="color:var(--astro-code-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--astro-code-color-text)">        [</span><span style="color:var(--astro-code-token-string-expression)">"Math.parseInt"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> "$3"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-constant)"> 16</span><span style="color:var(--astro-code-color-text)">]</span><span style="color:var(--astro-code-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--astro-code-color-text)">        [</span><span style="color:var(--astro-code-token-string-expression)">"String.concat"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> ","</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> "$4"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> "$5"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> "$6"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> "$0"</span><span style="color:var(--astro-code-color-text)">]</span><span style="color:var(--astro-code-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--astro-code-color-text)">        [</span><span style="color:var(--astro-code-token-string-expression)">"String.concat"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> ""</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> "rgba("</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> "$7"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> ")"</span><span style="color:var(--astro-code-color-text)">]</span></span>
<span class="line"><span style="color:var(--astro-code-color-text)">      ]</span></span>
<span class="line"><span style="color:var(--astro-code-color-text)">    ]</span></span>
<span class="line"><span style="color:var(--astro-code-color-text)">  }</span></span>
<span class="line"><span style="color:var(--astro-code-color-text)">}</span></span></code></pre>
<p>The purpose of this is so imported operations can be chained while maintaining the positional references for each step. In other words, we want to maintain the meaning of <code>$0</code> related to the rest of the steps in place.</p>
<p>In this way, as long as token processors include the low-level operational functions and the standardized way to execute them, you can define any kind of transform you need right within the token file.</p> </article> </div> </body>